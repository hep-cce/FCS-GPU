# HMATools

HMATools is a Python package to parse and plot logfiles produced by [FastCaloSim](https://github.com/hep-cce/FCS-GPU) and ultimately other HEPMiniApps (HMA). This README contains general installation and usage information.

For deeper and more technical information, please be referred to the [Developer Guide](./hmatools_dev_guide.md).

## Installation? Should it become its own repo?

This is currently an open question, since HMATools is integrated inside a wrapper repository.
As of now, clone [FastCaloSim](https://github.com/hep-cce/FCS-GPU), navigate to Directory `hmatools` and inside run:

```sh
pip install -e .
```

However, in the future we want to support something along the lines of this:
!!!Currently not supported!!!
```sh
pip install git+https://github.com/lorenz369/self_hosted_runner#egg=hmatools
```

## Usage

### Postprocessing
The `hma_result.py` currently processes log files generated by FastCaloSim. To parse an entire directory or a single log file, provide its input path (-i/--input), and provide the output directory/filepath (-o/--output) where you'd like to save the processed JSON file. The script will search for log files in the specified path, and save the processed results as a JSON file in the output directory.

Example usage of Command Line Interface:

```sh
postprocess --input ./logs --output ./output
```

If you are integrating `hma_result.py` into a larger workflow, you might use it as follows:

```python
from hmatools.hma_result import HmaResult

# Initialize the HmaResult with a directory or a single log file
result = HmaResult("./logs")

# Retrieve the results
runs = result.get_results()

# Optionally, dump the results to a JSON file
result.dump_to_json("./output/results.json")
```

### Plotting

The `hma_plot.py` module generates visualizations from JSON files produced during the previous postprocessing step with `hma_result.py`. This module reads the JSON files from a specified path and creates bar plots comparing different technologies and kernel run times. The plots are saved in the specified output directory.

Example usage of Command Line Interface:

```sh
postprocess --input ./logs --output ./output
```

If you are integrating `hma_plot.py` into a larger workflow, you might use it as follows:

```python
from hmatools.hma_plot import HmaPlot

# Initialize the HmaPlot with a directory or a single result file
plot = HmaPlot("./results")

# Generate and save the plot
plot.plot(save_plot=True, filename="./output/plot.png")



